# 2.2. IAM Avanzado

-> [Ãndice principal](./Index.md) -> [2.1. IAM - Identity and Access Management](./2.1.%20IAM%20-%20Identity%20and%20Access%20Management.md)

-> [VersiÃ³n en inglÃ©s](/SAA-C03/en/2.2%20IAM%20Advanced.md) **PENDIENTE**

## Ãndice

- [1. Resumen rÃ¡pido](#1-resumen-rÃ¡pido)
- [2. ExplicaciÃ³n en detalle](#2-explicaciÃ³n-en-detalle)
- [3. PrÃ¡cticas Hands-On Labs](#3-prÃ¡cticas-hands-on-labs)
- [4. Casos de uso](#4-casos-de-uso)
- [5. Notas adicionales](#5-notas-adicionales)
- [6. Recursos oficiales](#6-recursos-oficiales)

## 1. Resumen rÃ¡pido

ðŸ’¡ **CLAVES PARA EL EXAMEN:**

## 2. ExplicaciÃ³n en detalle

En esta segunda parte vamos a profundizar en el uso de los *roles* y cÃ³mo se relacionan con instancias **EC2**, ya que puede ser un concepto algo mÃ¡s difÃ­cil de asimilar, pero dada su utilidad y frecuencia es clave entenderlo bien.

Un **rol** es similar a un usuario de IAM. Tiene una serie de permisos definidos sobre lo que puede y lo que no puede hacer, pero con una diferencia esencial: **no pertenece a una persona o servicio concreto**, sino que puede ser **asumido temporalmente** por quien lo necesite (usuarios, grupos, aplicaciones o servicios tanto de AWS como de terceros).

Dichos permisos se superponen a los del usuario original, es decir, da igual que un usuario sea administrador del sistema, porque mientras asuma un rol con menores privilegios, tendrÃ¡ acceso Ãºnicamente a los privilegios asignados en/a dicho rol.

Por ponerlo en tÃ©rminos coloquiales y sencillos, es como un papel en una obra de teatro. Una entidad tiene las caracterÃ­sticas que tiene, pero cuando entra en el papel (es decir, interpreta otro rol), este pasa **temporalmente** a tener las caracterÃ­sticas de ese rol.

Hay 3 tipos de roles:

- **Servicios ligados a servicios (*Service-linked Roles*)**: Permite que los servicios de AWS accedan a otros servicios de AWS de manera segura.
- **Perfiles de instancias (*Instance Profiles*)**: Unidos a instancias EC2 que permiten el uso de un rol IAM.
- **Identidades federadas (*Federated Identities*)**: Permite a entidades externas asumir roles.

> ðŸ”¹**Ejemplos**:
>
> - *TÃ©cnico*:
>   - Para usuarios: Un administrador asume temporalmente un rol con los permisos de un usuario para comprobar que la configuraciÃ³n es correcta, y luego vuelve a su rol habitual.
>   - Para apps/servicios: Una instancia EC2 por defecto no tiene permisos especiales. Si necesita acceder a S3 u otro servicio, se le asigna un rol IAM que le otorga esos permisos de forma temporal. Al terminar la tarea, la instancia deja de usar el rol y ya no conserva privilegios adicionales.
>   - Para terceros: Una auditorÃ­a de ciberseguridad independiente requiere que sus empleados accedan al almacenamiento de los datos sensibles en un bucket S3 de una empresa. Finalizada la auditorÃ­a, dejan de tener acceso.
> - *Coloquial*:
>   - Para usuarios: Un usuario, por el dÃ­a es un miembro de a piÃ© con los privilegios mÃ­nimos. Pero por la noche cambia de rol y se convierte en un murciÃ©lago justiciero. Es decir, cambia de rol temporalmente, siendo alguien con privilegios y capacidades totalmente distintas.
>   - Para apps/servicios: Una polideportivo normalmente es usado para representar deportes y solo tiene acceso los deportistas. Pero en caso de desastre natural, cambia de rol y sirve como refugio para cualquiera que lo necesite hasta que termine la tormenta.
>   - Para terceros: Un persona quiere entrar a un edificio gubernamental y le dan una tarjeta de acceso que pone "visitante", dÃ¡ndole acceso solo a los sitios autorizados para y durante la visita.
>
> En ambos casos, la idea clave es que los roles otorgan permisos de manera temporal, permitiendo realizar tareas especÃ­ficas sin modificar los privilegios permanentes del usuario o servicio.

### AWS Security Token Service (STS)

Los Roles de IAM se apoyan en el servicio de tokens seguros para generar y gestionar los accesos temporales que tanto les caracteriza.

Estas credenciales pueden durar entre 15 minutos a 12 horas segÃºn la configuraciÃ³n usada; es comÃºnmente usado en Federaciones SAML o OpenID Connect y soporta condiciones adicionales de acceso como la autenticaciÃ³n de factor mÃºltiple (MFA).

### IAM Role Trust Policies

Como el resto de identidades, los roles tienen una serie de polÃ­ticas, en este caso llamadas **polÃ­ticas de confianza (*Trust Policies*)**, que estÃ¡n basadas en recursos y en formato JSON.

Dadas las caracterÃ­sticas de los roles, es obligatorio definir una identidad a la que va dirijida el rol para indicarle a AWS en quÃ© o a quiÃ©n confiarle la polÃ­tica (de ahÃ­ su nombre). Estos pueden ser usuarios de IAM, roles de IAM, otras cuentas de AWS, servicios de AWS, o incluso terceros.

> ðŸ”¹**Ejemplo** de Trust Policy donde al usuario "Ana" se le permite que asuma un rol, pero solo si iniciÃ³ sesiÃ³n con MFA activado.
>
> ```json
> {
>    "Version": "2012-10-17",
>    "Statement": [
>        {
>        "Effect": "Allow",
>        "Principal": {
>            "AWS": "arn:aws:iam::123456789012:user/Ana"
>        },
>        "Action": "sts:AssumeRole",
>        "Condition": {
>            "Bool": {
>            "aws:MultiFactorAuthPresent": "true"
>            }
>        }
>        }
>    ]
> }

## 3. PrÃ¡cticas Hands-On Labs

## 4. Casos de uso

## 5. Notas adicionales

Â¡Enhorabuena, has completado IAM! ðŸŽ‰  
Este es uno de los temas mÃ¡s importantes de todo el examen y tambiÃ©n en la vida real trabajando con AWS.  

Recuerda:  

- La seguridad no es un extra, es la base de todo.  
- Entender IAM te da control total sobre tu infraestructura.  
- La prÃ¡ctica es tu mejor aliada: prueba, rompe y vuelve a configurar hasta que lo domines.  

Ahora que ya tienes este bloque en tus manos, estÃ¡s un paso mÃ¡s cerca de dominar AWS. ðŸš€

## 6. Recursos oficiales

- [AWS IAM Documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html)
- [AWS IAM Federation](https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/id_roles_providers.html)

---

*Siguiente lecciÃ³n: [3. ](./3.%20)*
