# 2.2. IAM Avanzado

-> [Índice principal](./Index.md) -> [2.1. IAM - Identity and Access Management](./2.1.%20IAM%20-%20Identity%20and%20Access%20Management.md)

-> [Versión en inglés](/SAA-C03/en/2.2%20IAM%20Advanced.md) **PENDIENTE**

## Índice

- [1. Resumen rápido](#1-resumen-rápido)
- [2. Explicación en detalle](#2-explicación-en-detalle)
- [3. Prácticas Hands-On Labs](#3-prácticas-hands-on-labs)
- [4. Casos de uso](#4-casos-de-uso)
- [5. Notas adicionales](#5-notas-adicionales)
- [6. Recursos oficiales](#6-recursos-oficiales)

## 1. Resumen rápido

💡 **CLAVES PARA EL EXAMEN:**

## 2. Explicación en detalle

En esta segunda parte vamos a profundizar en el uso de los *roles* y cómo se relacionan con instancias **EC2**, ya que puede ser un concepto algo más difícil de asimilar, pero dada su utilidad y frecuencia es clave entenderlo bien.

Un **rol** es similar a un usuario de IAM. Tiene una serie de permisos definidos sobre lo que puede y lo que no puede hacer, pero con una diferencia esencial: **no pertenece a una persona o servicio concreto**, sino que puede ser **asumido temporalmente** por quien lo necesite (usuarios, grupos, aplicaciones o servicios tanto de AWS como de terceros).

Dichos permisos se superponen a los del usuario original, es decir, da igual que un usuario sea administrador del sistema, porque mientras asuma un rol con menores privilegios, tendrá acceso únicamente a los privilegios asignados en/a dicho rol.

Por ponerlo en términos coloquiales y sencillos, es como un papel en una obra de teatro. Una entidad tiene las características que tiene, pero cuando entra en el papel (es decir, interpreta otro rol), este pasa **temporalmente** a tener las características de ese rol.

Hay 3 tipos de roles:

- **Servicios ligados a servicios (*Service-linked Roles*)**: Permite que los servicios de AWS accedan a otros servicios de AWS de manera segura.
- **Perfiles de instancias (*Instance Profiles*)**: Unidos a instancias EC2 que permiten el uso de un rol IAM.
- **Identidades federadas (*Federated Identities*)**: Permite a entidades externas asumir roles.

> 🔹**Ejemplos**:
>
> - *Técnico*:
>   - Para usuarios: Un administrador asume temporalmente un rol con los permisos de un usuario para comprobar que la configuración es correcta, y luego vuelve a su rol habitual.
>   - Para apps/servicios: Una instancia EC2 por defecto no tiene permisos especiales. Si necesita acceder a S3 u otro servicio, se le asigna un rol IAM que le otorga esos permisos de forma temporal. Al terminar la tarea, la instancia deja de usar el rol y ya no conserva privilegios adicionales.
>   - Para terceros: Una auditoría de ciberseguridad independiente requiere que sus empleados accedan al almacenamiento de los datos sensibles en un bucket S3 de una empresa. Finalizada la auditoría, dejan de tener acceso.
> - *Coloquial*:
>   - Para usuarios: Un usuario, por el día es un miembro de a pié con los privilegios mínimos. Pero por la noche cambia de rol y se convierte en un murciélago justiciero. Es decir, cambia de rol temporalmente, siendo alguien con privilegios y capacidades totalmente distintas.
>   - Para apps/servicios: Una polideportivo normalmente es usado para representar deportes y solo tiene acceso los deportistas. Pero en caso de desastre natural, cambia de rol y sirve como refugio para cualquiera que lo necesite hasta que termine la tormenta.
>   - Para terceros: Un persona quiere entrar a un edificio gubernamental y le dan una tarjeta de acceso que pone "visitante", dándole acceso solo a los sitios autorizados para y durante la visita.
>
> En ambos casos, la idea clave es que los roles otorgan permisos de manera temporal, permitiendo realizar tareas específicas sin modificar los privilegios permanentes del usuario o servicio.

### AWS Security Token Service (STS)

Los Roles de IAM se apoyan en el servicio de tokens seguros para generar y gestionar los accesos temporales que tanto les caracteriza.

Estas credenciales pueden durar entre 15 minutos a 12 horas según la configuración usada; es comúnmente usado en Federaciones SAML o OpenID Connect y soporta condiciones adicionales de acceso como la autenticación de factor múltiple (MFA).

### IAM Role Trust Policies

Como el resto de identidades, los roles tienen una serie de políticas, en este caso llamadas **políticas de confianza (*Trust Policies*)**, que están basadas en recursos y en formato JSON.

Dadas las características de los roles, es obligatorio definir una identidad a la que va dirijida el rol para indicarle a AWS en qué o a quién confiarle la política (de ahí su nombre). Estos pueden ser usuarios de IAM, roles de IAM, otras cuentas de AWS, servicios de AWS, o incluso terceros.

> 🔹**Ejemplo** de Trust Policy donde al usuario "Ana" se le permite que asuma un rol, pero solo si inició sesión con MFA activado.
>
> ```json
> {
>    "Version": "2012-10-17",
>    "Statement": [
>        {
>        "Effect": "Allow",
>        "Principal": {
>            "AWS": "arn:aws:iam::123456789012:user/Ana"
>        },
>        "Action": "sts:AssumeRole",
>        "Condition": {
>            "Bool": {
>            "aws:MultiFactorAuthPresent": "true"
>            }
>        }
>        }
>    ]
> }

## 3. Prácticas Hands-On Labs

## 4. Casos de uso

## 5. Notas adicionales

¡Enhorabuena, has completado IAM! 🎉  
Este es uno de los temas más importantes de todo el examen y también en la vida real trabajando con AWS.  

Recuerda:  

- La seguridad no es un extra, es la base de todo.  
- Entender IAM te da control total sobre tu infraestructura.  
- La práctica es tu mejor aliada: prueba, rompe y vuelve a configurar hasta que lo domines.  

Ahora que ya tienes este bloque en tus manos, estás un paso más cerca de dominar AWS. 🚀

## 6. Recursos oficiales

- [AWS IAM Documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html)
- [AWS IAM Federation](https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/id_roles_providers.html)

---

*Siguiente lección: [3. ](./3.%20)*
