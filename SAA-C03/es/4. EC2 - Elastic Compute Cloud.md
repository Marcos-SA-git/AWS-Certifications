# 4. EC2 - Elastic Compute Cloud

-> [√çndice principal](./Index.md) -> [3. VPC - Virtual Private Cloud](./3.%20VPC%20-%20Virtual%20Private%20Cloud.md)

-> [Versi√≥n en ingl√©s](/SAA-C03/en/[nombre-del-archivo-en-ingl√©s].md) **PENDIENTE**

## √çndice

- [1. Resumen r√°pido](#1-resumen-r√°pido)
- [2. Explicaci√≥n en detalle](#2-explicaci√≥n-en-detalle)
- [3. Pr√°cticas Hands-On Labs](#3-pr√°cticas-hands-on-labs)
- [4. Casos de uso](#4-casos-de-uso)
- [5. Notas adicionales](#5-notas-adicionales)
- [6. Recursos oficiales](#6-recursos-oficiales)

## 1. Resumen r√°pido

üí° **CLAVES PARA EL EXAMEN**

## 2. Explicaci√≥n en detalle

La **Computaci√≥n El√°stica en la Nube (*Elastic Compute Cloud* o *EC2*)** es uno de los principales servicios por los que la nube de AWS es conocida. Se trata de una Infraestructura como Servicio o IaaS (Infrastructure as a Service) ya que ofrece la capacidad de ejecutar m√°quinas virtuales totalmente personalizables en la nube de manera r√°pida, eficiente, altamente disponible y escalable, entre otras cosas.

En otras palabras, puedes tener tu propio ordenador en la nube. Y como tal, debes escoger los componentes correctos:

- Computaci√≥n (*Compute*): Se refiere a la cantidad de CPUs virtuales que vas a necesitar.
- Memoria (*Memory*): Se refiere a la cantidad de RAM necesaria para correr las aplicaciones que uses.
- Conectividad (*Network*): Qu√© tanto ancho de banda / velocidad vas a necesitar.
- Almacenamiento (*Storage*): Ya sea un disco duro virtual, cach√© o en red.

### Tipos de instancias

EC2 divide sus instancias:

- **Por tama√±o**: Es la clasificaci√≥n m√°s simple ya que sencillamente se refiere a la cantidad de recursos (memoria, CPU y conectividad). Hay varios tama√±os disponibles, como micro, small, large, etc.
- **Por familia/clase/tipo y generaci√≥n**: Hay cargas de trabajo que requieren instancias pensadas para desarrollar dichos trabajos de manera √≥ptima, no es lo mismo ejecutar un servidor web, que querer renderizar una pel√≠cula o generar un modelo de inteligencia artificial. Por tanto, seg√∫n el trabajo a desarrollar deberemos escoger la familia adecuada.

Sabiendo esto, para poder escoger el tipo de instancia que nos conviene, se utiliza una nomenclatura estandarizada:

1ro: Se indica la familia con una letra. Ej: t
2do: Se indica la generaci√≥n de la instancia. Ej: 4
3ro: Se indican las caracter√≠sticas opcionales. Ej. g
4to: Se indica el tama√±o de la instancia: Ej: large

Quedando as√≠: "t4g.large", es decir, instancia de caracter general, cuarta generaci√≥n, tipo de procesador AWS Graviton y con grandes capacidades de recursos.

#### Familias de instancias

Veamos en mayor profundidad las diferentes familias que ofrece AWS:

- **Prop√≥sito general (M & T)**: Ofrece un balance en capacidades de computaci√≥n, memoria y red. Tienen la caracter√≠stica adicional de que pueden ir moment√°neamente por encima de sus capacidades originales, a esto se le denomina (burstable).
- **C√≥mputo Optimizadas (C)**: Ofrece procesadores muy potentes, ideales para cargas que requieran c√°lculos intensivos.
- **Memoria Optimizadas (R ; X & Z)**: Ideales para tareas que requieran procesar grandes cantidades de datos a la vez o para cach√©.
- **Computaci√≥n Acelerada (P & G)**: Perfectas para renderizaci√≥n por hardware, como trascodificar o renderizar gr√°ficos. Incluye gr√°ficas dedicadas para dichas tareas.
- **Almacenamiento Optimizadas (I)**: Usadas en casos que se requiere escribir o leer datos de manera secuencial y con baja latencia.
- **HPC Optimizadas (HPC)**: Son instancias para computaciones extremas (High Performance Computing), para casos como simulaciones o Machine Learning.

> **Nota**: La clave para entender la diferencias entre familia y tama√±o es que la familia indica c√≥mo est√° montada o pensada la infraestructura sobre la que se ejecuta la instancia. Mientras que el tama√±o son la cantidad de recursos con los que cuenta. O en otras palabras, podemos tener una instancia del tipo C, para alta computaci√≥n, pero de tama√±o micro, es decir tal vez 1 o 2 CPUs de ese tipo.

### AMIs

Las **Im√°genes de M√°quinas de Amazon (*Amazon Machine Image* o *AMI*)**, es una caracter√≠stica de EC2 que permite escoger, crear y/o compartir im√°genes de sistemas ya configurados. Al estar ya configuradas, se despliegan con much√≠sima facilidad y velocidad, de manera pr√°cticamente instant√°nea.

En otras palabras, vendr√≠an a ser plantillas de m√°quinas virtuales las cuales se pueden usar para crear m√∫ltiples instancias en cuesti√≥n de segundos, todas estandarizadas y personalizadas a nuestro gusto. Tambi√©n se ofrece la posibilidad de, adem√°s, crear nuestras propias AMIs as√≠ como compartirlas con el mundo o con usuarios espec√≠ficos de AWS.

Amazon pone a nuestra disposici√≥n AMIs por defecto ya configuradas con las herramientas m√°s comunes, en diferentes sistemas operativos para que tengamos un despliegue r√°pido y eficaz.

> üóíÔ∏è**Nota**: Normalmente lo que se suele hacer es usar una AMI de base, o crear una imagen desde cero y personalizarla para crear una "golden image" que se usar√° como plantilla en toda la organizaci√≥n, permitiendo despliegues estandarizados de manera r√°pida y controlada.

### User Data

Vendr√≠a a ser lo contrario o un paso previo a las AMIs. Los **datos de usuario (*User Data*)**, vendr√≠an a ser comandos, tanto en texto plano como en Base64, que se ejecutan la primera vez o cada vez que se arranca la instancia. Estos scripts (llamados "*Bootstap scripts*" en ingl√©s) suelen ser usados para instalar programas, y/o configurar servicios u otras acciones, dejando la instancia preparada como nosotros queremos sin necesidad de realizar los ajustes manualmente.

> üóíÔ∏è**Nota**: Se pueden codificar en Base64 ya que esto permite que, en sripts m√°s complejos, se eliminen espacios o tabulaciones que podr√≠an causar algunos errores o confusi√≥n a la m√°quina a la hora de ejecutarlo.

> üîπ**Ejemplo**:
>
> Texto plano:
>
> ```bash
> sudo apt update
> sudo apt upgrade
> ```
>
> Base64:
>
> ```base64
> c3VkbyBhcHQgdXBkYXRlCnN1ZG8gYXB0IHVwZ3JhZGU=
> ```
>
> Ambos hacen lo mismo, en este caso actualizar la lista de paquetes disponibles y aplicar todas las actualizaciones. (En Linux).
> Cabe aclarar que Base64 **no** es una forma de encriptaci√≥n.

> ‚úÖ**Buenas pr√°cticas**: En entornos de producci√≥n suele emplearse una combinaci√≥n de ambas t√©cnicas: se parte de una AMI base (golden image) y se complementa con un script de *User Data* que personaliza la instancia seg√∫n la tarea espec√≠fica que vaya a desempe√±ar. Lo m√°s com√∫n es hacer que la instancia se una a un dominio o configurar cosas como la zona horaria, idioma y/o distribuci√≥n de teclado

### EC2 Hibernate

Una caracter√≠stica muy √∫til para acelerar el tiempo de inicio de una instancia, es la opci√≥n de Hibernar (Hibernate). Esto consiste en, mientras se est√° ejecutando la m√°quina, guardar todo el contenido de la RAM, en el volumen ra√≠z, pr√°cticamente congelando el estado de la m√°quina.

Para su recuperaci√≥n, primero se carga el volumen ra√≠z, para seguidamente leer y cargar el contenido previamente guardado de la RAM de vuelta a la misma. De ah√≠, los procesos que se estaban ejecutando vuelven a iniciarse como si nunca se hubieran detenido, y los vol√∫menes adicionales se re-adjuntan a la instancia manteniendo su ID.

Es muy usado cuando una aplicaci√≥n pesada tarda mucho tiempo en cargar o en desplegarse/alcanzar hasta cierto punto y nos queremos ahorrar todo ese tiempo.

### Tipos de almacenamiento

Las instancias EC2, como cualquier m√°quina virtual, usan vol√∫menes denominados **Almacenamiento en Bloques (*Block Storage*)**, donde almancenar el SO, las aplicaciones, las configuraciones y los datos, entre otras cosas. Hay 2 tipos de almacenamiento por bloques:

- **Almacenamiento de instancia (*Instance Store*)**: Son un tipo de almacenamiento **temporal** que depende de la familia y el tama√±o de la instancia EC2.

Solo se pueden adjuntar en el momento de la creaci√≥n de la instancia, una vez configurada la instancia, no se pueden ni quitar, ni poner, ni en fr√≠o, ni en caliente. Si nos hemos olvidado de a√±adir este tipo de almacenamiento, tendremos que crear una nueva instancia para poder incluir el Instance Store.

La peculiaridad de este tipo de vol√∫menes es que su contenido solo permanece si la instancia es reiniciada, pero si se para, hiberna o elimina, el contenido y los vol√∫menes ef√≠meros son criptogr√°ficamente eliminados.

Son particulamente √∫tiles para buffers, cach√© o datos que no sean cr√≠ticos o relevantes.

- **Almacenamiento El√°stico en Bloques (*Elastic Block Storage* o *EBS*)**: Es un tipo de almacenamiento en bloques/vol√∫menes, escalable y de alto rendimiento, que pueden ser usados en instancias EC2. A su vez hay diferentes familias de vol√∫menes EBS:
  - **SSDs de prop√≥sito general**: Para trabajos que requieren balance entre desempe√±o y coste. Hay 2 tipos:
    - **gp2**: Apto para ser disco booteable, con hasta 16.000 IOPS, y 99.9% de durabilidad.
    - **gp3**: Pensados para tareas intensivas, con 3.000 IOPS predecibles como base y 125 MiB/s independientemente del tama√±o de los vol√∫menes, con un 99.9% de durabilidad.
  - **SSDs optimizados para IOPS**: Principalmente pensados para tareas con multitud de escrituras y lecturas simult√°neas por segundo (Inputs / Ouputs per second o IOPS), que requieran altos niveles de rendimiento, como bases de datos relacionales. Hay 2 tipos:
    - **io1**: Aplicables al Procesamiento On-Line de Transferencias (On-Line Transaction Procesing o OLTP) y aplicaciones sensibles a la latencia. Ofrecen 50 IOPS/GiB y hasta 64.000 IOPS por volumen. Con una durabilidad del 99.9% y son el tipo m√°s caro.
    - **io2**: Parecido al anterior, pero con 500 IOPS/GiB y hasta 64.000 IOPS por volumen, 99.999% de durabilidad y los √∫ltimos vol√∫menes optimizados para este tipo de tareas. Incluso son m√°s baratos que la opci√≥n de io2, no hay razones para decidir la generaci√≥n anterior sobre esta.
  - **HDDs magn√©ticos**: Para archivar datos o backups. Ideales para grandes vol√∫menes de datos infrecuentemente usados que necesitan se necesiten almacenar de manera barata y para larga duraci√≥n. Tienen la peculiaridad que no pueden ser usados como discos de inicio ("booteables") en instancias EC2. Su principal caracter√≠stica es que se mide por su **tasa de transferencia (*Throughput*)** y no por IOPS.
    - **st1**: Con una velocidad base de 40 MB/s por TB, hasta un m√°ximo de 250 MB/s, es decir, a partir de los 6'25TB se alcanza la velocidad m√°xima sostenida, con posibilidad de aumentar temporalmente hasta los 500MB/s por volumen. Ideal para monta√±as de datos.
    - **sc1**: Son la opci√≥n m√°s barata, con una velocidad base de 12 MB/s por TB hasta un m√°ximo de 80MB/s sostenidos y picos temporales de hasta 250MB/s por volumen. Una buena opci√≥n cuando el rendimiento no es importante, no se va a hacer un gran uso al d√≠a de los datos y se necesita la opci√≥n m√°s barata.

#### Diferencia entre IOPS y la Tasa de Trasferencia

A continuaci√≥n tienes una tabla que explica bien la diferencia de estos dos t√©rminos que a menudo se confunden pero que es vital entender su diferencia ya que se usan en situaciones y contextos distintos.

| Caracter√≠stica | **IOPS (Input/Output Operations per Second)** | **Throughput (Tasa de transferencia / Ancho de banda)** |
|----------------|-----------------------------------------------|----------------------------------------------------------|
| **Definici√≥n** | Mide **cu√°ntas operaciones** de lectura/escritura se pueden realizar por segundo. | Mide **cu√°ntos datos** pueden transferirse por segundo de manera sostenida. |
| **Unidad** | Operaciones por segundo (ops/s) | Megabytes por segundo (MB/s o MiB/s) |
| **En qu√© influye** | Velocidad al procesar **archivos peque√±os y frecuentes**. | Velocidad al procesar **archivos grandes y secuenciales**. |
| **Depende de** | Tama√±o de bloque, latencia, tipo de almacenamiento. | Tama√±o de bloque, ancho de banda, tama√±o del volumen. |
| **Ejemplo t√≠pico** | 3.000 IOPS con bloques de 4 KB = 12 MB/s aprox. | 250 MB/s = 62.500 operaciones de 4 KB por segundo aprox. |
| **Tipo de volumen AWS asociado** | **SSD:** gp2, gp3, io1, io2 | **HDD:** st1, sc1 |
| **Uso ideal** | Bases de datos, sistemas OLTP, acceso aleatorio. | Big Data, an√°lisis, backups, streaming, logs secuenciales. |
| **Optimizado para** | **Latencia baja** y operaciones r√°pidas. | **Transferencia masiva** y throughput sostenido. |
| **Analog√≠a** | üöó Cu√°ntos viajes haces por segundo. | üöö Cu√°ntos kilos transportas por segundo. |

### Par de Claves

## 3. Pr√°cticas Hands-On Labs

## 4. Casos de uso

## 5. Notas adicionales

## 6. Recursos oficiales

- [Nomenclatura de intancias EC2](https://docs.aws.amazon.com/ec2/latest/instancetypes/instance-type-names.html)

---

*Siguiente lecci√≥n: [X.(X+1). Nombre de la siguiente lecci√≥n](./X.(X+1).%20Nombre%20de%20la%20siguiente%20lecci√≥n.md)*
